<launch>
    <arg name="use_gazebo" default="false"/>
    <arg name="use_joy" default="false"/>
    <arg name="joy_device" default="/dev/input/js0"/>
    <arg name="diff_drive_controller_name" value="base_controller"/>

    <!-- local slave - control station -->
    <machine name="dev-machine"
        address="$(env ROS_HOSTNAME)"
        unless="$(arg use_gazebo)"/>

    <!-- simulation - local machine only -->
    <machine name="dev-machine"
        address="localhost"
        if="$(arg use_gazebo)"/>

    <node unless="$(arg use_joy)"
        pkg="teleop_twist_keyboard"
        name="teleop_node"
        type="teleop_twist_keyboard.py"
        output="screen">
        <remap from="cmd_vel" to="/$(arg diff_drive_controller_name)/cmd_vel"/>
    </node>

    <group if="$(arg use_joy)">
        <node pkg="joy"
            name="joy_node"
            type="joy_node"
            output="screen">
            <param name="~dev" value="$(arg joy_device)"/>
        </node>

        <node pkg="teleop_twist_joy"
            name="teleop_node"
            type="teleop_node"
            output="screen">
            <!-- mappings for x360 controller -->
            <param name="~enable_button" value="4"/>
            <param name="~enable_turbo_button" value="5"/>
            <param name="~axis_linear" value="1" type="int"/>
            <param name="~axis_angular" value="3" type="int"/>

            <!-- TODO map to base_controller speed params -->
            <param name="~scale_linear" value="0.3" type="double"/>
            <param name="~scale_linear_turbo" value="0.5" type="double"/>
            <param name="~scale_angular" value="1.5" type="double"/>

            <remap from="cmd_vel" to="/$(arg diff_drive_controller_name)/cmd_vel"/>
        </node>
    </group>

    <node name="rviz" pkg="rviz" type="rviz" args="-d $(find robot_control)/rviz/teleop.rviz"/>
</launch>
